# 窗口函数

## ROW_NUMBER

ROW_NUMBER: 为结果集每一行分配唯一~连续的序号

1. 窗口函数: 不同于sum合并行, 为每一行计算一个值, eg: ROW_NUMBER
2. ROW_NUMBER(): 根据over子句的排序规则,为每一行生成唯一的序号
3. OVER(PARTITION BY ...): 定义如何为数据分组和排序

```sql
-- 全公司按销售额排名
SELECT ROW_NUMBER() OVER (ORDER BY amount desc) AS row_num, sale_id,
       employee,
       department,
       amount
FROM sales;
-- 分部门按销售额排名
SELECT ROW_NUMBER() OVER (partition BY department ORDER BY sale_id desc) AS row_num, sale_id,
       employee,
       department,
       amount
FROM sales;
-- 找出每个部门销售额前2
select *
from (SELECT ROW_NUMBER() OVER (partition BY department ORDER BY amount desc) AS row_num, sale_id,
             employee,
             department,
             amount
      FROM sales) a
where a.row_num < 3;
-- 按销售额排序做分页,页码为2,每页2行
select * from (
    select row_number() over (order by amount desc) as row_num, 
           sale_id,
           employee,
           department,
           amount
        from sales
) a 
where a.row_num between 3 and 4;
```